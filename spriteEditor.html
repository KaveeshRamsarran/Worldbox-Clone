<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worldbox Sprite Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background-color: rgba(42, 42, 42, 0.8);
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 20px;
        }

        h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        .canvas-wrapper {
            text-align: center;
            margin-bottom: 20px;
        }

        #editorCanvas {
            border: 3px solid #4CAF50;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            background-color: #0a0a0a;
            max-width: 100%;
            display: block;
            margin: 0 auto 15px;
        }

        .tool-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            background-color: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tool-button:hover {
            background-color: rgba(76, 175, 80, 0.4);
        }

        .tool-button.active {
            background-color: #4CAF50;
            color: #1a1a1a;
        }

        .color-picker {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 15px 0;
        }

        .color-swatch {
            width: 100%;
            padding: 15px;
            border: 2px solid #555;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-swatch:hover {
            border-color: #4CAF50;
            transform: scale(1.05);
        }

        .color-swatch.selected {
            border: 3px solid #FFD700;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .preview {
            border: 2px solid #4CAF50;
            padding: 20px;
            text-align: center;
            border-radius: 6px;
            margin: 15px 0;
            background-color: rgba(76, 175, 80, 0.05);
        }

        #previewCanvas {
            border: 2px solid #666;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            background-color: #0a0a0a;
            margin: 10px auto;
            display: block;
        }

        .controls {
            margin: 15px 0;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #4CAF50;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            color: #fff;
            border-radius: 4px;
            font-size: 14px;
        }

        input[type="text"]::placeholder,
        input[type="number"]::placeholder {
            color: #888;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #66BB6A;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background-color: #4CAF50;
            color: #1a1a1a;
        }

        .btn-primary:hover {
            background-color: #66BB6A;
        }

        .btn-secondary {
            background-color: #555;
            color: #fff;
        }

        .btn-secondary:hover {
            background-color: #777;
        }

        .btn-danger {
            background-color: #f44336;
            color: #fff;
        }

        .btn-danger:hover {
            background-color: #da190b;
        }

        .btn-full {
            grid-column: 1 / -1;
        }

        .preset-colors {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 10px 0;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            grid-column: 1 / -1;
        }

        .header h1 {
            color: #4CAF50;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #aaa;
            font-size: 14px;
        }

        .info-text {
            color: #aaa;
            font-size: 12px;
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(76, 175, 80, 0.05);
            border-left: 2px solid #4CAF50;
            border-radius: 4px;
        }

        .grid-size-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé® Sprite Editor</h1>
        <p>Create custom 2D pixelated sprites for your world</p>
    </div>

    <div class="container">
        <!-- Editor Panel -->
        <div class="panel">
            <h2>‚úèÔ∏è Editor</h2>
            
            <div class="control-group">
                <label>Grid Size</label>
                <div class="grid-size-input">
                    <input type="number" id="gridWidth" min="8" max="32" value="16" placeholder="Width">
                    <input type="number" id="gridHeight" min="8" max="32" value="16" placeholder="Height">
                </div>
                <button class="tool-button" onclick="resizeGrid()">Apply Size</button>
            </div>

            <div class="canvas-wrapper">
                <canvas id="editorCanvas" width="256" height="256"></canvas>
            </div>

            <div class="tool-button" id="toolPen" onclick="selectTool('pen')">‚úèÔ∏è Pen</div>
            <div class="tool-button" id="toolEraser" onclick="selectTool('eraser')">üóëÔ∏è Eraser</div>
            <div class="tool-button" id="toolBucket" onclick="selectTool('bucket')">ü™£ Bucket Fill</div>
            <div class="tool-button" id="toolPickColor" onclick="selectTool('pickcolor')">üéØ Pick Color</div>
            
            <button class="tool-button" onclick="clearCanvas()">Clear All</button>
            <button class="tool-button" onclick="undoAction()">‚Ü∂ Undo</button>
        </div>

        <!-- Color Panel -->
        <div class="panel">
            <h2>üé® Colors</h2>
            
            <div class="preview">
                <p>Selected Color</p>
                <div id="selectedColor" style="width: 100%; height: 40px; border: 2px solid #4CAF50; border-radius: 4px; margin-top: 10px;"></div>
            </div>

            <label>Preset Colors</label>
            <div class="color-picker">
                <div class="color-swatch selected" style="background-color: #000000;" onclick="selectColor('#000000')" title="Black"></div>
                <div class="color-swatch" style="background-color: #FFFFFF;" onclick="selectColor('#FFFFFF')" title="White"></div>
                <div class="color-swatch" style="background-color: #FF0000;" onclick="selectColor('#FF0000')" title="Red"></div>
                <div class="color-swatch" style="background-color: #00FF00;" onclick="selectColor('#00FF00')" title="Green"></div>
                <div class="color-swatch" style="background-color: #0000FF;" onclick="selectColor('#0000FF')" title="Blue"></div>
                <div class="color-swatch" style="background-color: #FFFF00;" onclick="selectColor('#FFFF00')" title="Yellow"></div>
                <div class="color-swatch" style="background-color: #FF00FF;" onclick="selectColor('#FF00FF')" title="Magenta"></div>
                <div class="color-swatch" style="background-color: #00FFFF;" onclick="selectColor('#00FFFF')" title="Cyan"></div>
            </div>

            <label style="margin-top: 15px;">Custom Color</label>
            <input type="text" id="customColor" placeholder="#000000" onchange="selectColor(this.value)">

            <label style="margin-top: 15px;">Common Sprite Colors</label>
            <div class="preset-colors">
                <div class="color-swatch" style="background-color: #4CAF50;" onclick="selectColor('#4CAF50')" title="Grass Green"></div>
                <div class="color-swatch" style="background-color: #8B7355;" onclick="selectColor('#8B7355')" title="Brown"></div>
                <div class="color-swatch" style="background-color: #808080;" onclick="selectColor('#808080')" title="Gray"></div>
                <div class="color-swatch" style="background-color: #4A4A4A;" onclick="selectColor('#4A4A4A')" title="Dark Gray"></div>
                <div class="color-swatch" style="background-color: #2196F3;" onclick="selectColor('#2196F3')" title="Water Blue"></div>
                <div class="color-swatch" style="background-color: #FFD700;" onclick="selectColor('#FFD700')" title="Gold"></div>
                <div class="color-swatch" style="background-color: #FF6B35;" onclick="selectColor('#FF6B35')" title="Lava Orange"></div>
                <div class="color-swatch" style="background-color: #654321;" onclick="selectColor('#654321')" title="Dark Brown"></div>
            </div>
        </div>

        <!-- Output Panel -->
        <div class="panel">
            <h2>üíæ Save & Export</h2>

            <div class="control-group">
                <label>Sprite Name</label>
                <input type="text" id="spriteName" placeholder="Enter sprite name" value="custom_sprite">
            </div>

            <div class="control-group">
                <label>Sprite Type</label>
                <select id="spriteType">
                    <option value="creature">Creature</option>
                    <option value="terrain">Terrain</option>
                    <option value="hazard">Hazard Effect</option>
                </select>
            </div>

            <div class="preview">
                <p>Live Preview (128x128)</p>
                <canvas id="previewCanvas" width="128" height="128"></canvas>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="exportSprite()">üì• Export</button>
                <button class="btn btn-secondary" onclick="downloadImage()">‚¨áÔ∏è Download</button>
            </div>

            <button class="btn btn-primary btn-full" onclick="addToGame()">‚ûï Add to Game</button>
            <button class="btn btn-secondary btn-full" onclick="goBack()">‚Üê Back to Game</button>

            <div class="info-text">
                <strong>‚úì Tips:</strong><br>
                ‚Ä¢ Click pixels to paint<br>
                ‚Ä¢ Use bucket fill for large areas<br>
                ‚Ä¢ Pick color to copy colors<br>
                ‚Ä¢ Save your sprite when done<br>
                ‚Ä¢ Export to use in game
            </div>
        </div>
    </div>

    <script>
        // Sprite Editor State
        let editorCanvas = document.getElementById('editorCanvas');
        let ctx = editorCanvas.getContext('2d');
        let previewCanvas = document.getElementById('previewCanvas');
        let previewCtx = previewCanvas.getContext('2d');

        let gridWidth = 16;
        let gridHeight = 16;
        let tileSize = 16;
        let selectedColor = '#000000';
        let selectedTool = 'pen';
        let history = [];
        let isDrawing = false;

        // Initialize editor
        function init() {
            updateEditorDisplay();
            updatePreview();
            updateSelectedColor();
            selectTool('pen');
        }

        function selectColor(color) {
            selectedColor = color;
            document.getElementById('customColor').value = color;
            updateSelectedColor();
            
            // Update color swatch selections
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                const bg = window.getComputedStyle(swatch).backgroundColor;
                const cssHex = rgbToHex(bg);
                swatch.classList.toggle('selected', cssHex.toUpperCase() === color.toUpperCase());
            });
        }

        function rgbToHex(rgb) {
            if (!rgb || rgb === 'rgba(0, 0, 0, 0)') return '#000000';
            const match = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/);
            if (!match) return '#000000';
            const hex = (x) => {
                return ("0" + parseInt(x).toString(16)).slice(-2);
            };
            return "#" + hex(match[1]) + hex(match[2]) + hex(match[3]);
        }

        function updateSelectedColor() {
            document.getElementById('selectedColor').style.backgroundColor = selectedColor;
        }

        function selectTool(tool) {
            selectedTool = tool;
            document.querySelectorAll('.tool-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('tool' + tool.charAt(0).toUpperCase() + tool.slice(1)).classList.add('active');
        }

        function resizeGrid() {
            gridWidth = parseInt(document.getElementById('gridWidth').value) || 16;
            gridHeight = parseInt(document.getElementById('gridHeight').value) || 16;
            gridWidth = Math.max(8, Math.min(32, gridWidth));
            gridHeight = Math.max(8, Math.min(32, gridHeight));
            
            document.getElementById('gridWidth').value = gridWidth;
            document.getElementById('gridHeight').value = gridHeight;

            tileSize = 256 / Math.max(gridWidth, gridHeight);
            saveHistory();
            updateEditorDisplay();
        }

        function updateEditorDisplay() {
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, editorCanvas.width, editorCanvas.height);

            // Draw grid
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= gridWidth; i++) {
                ctx.beginPath();
                ctx.moveTo(i * tileSize, 0);
                ctx.lineTo(i * tileSize, gridHeight * tileSize);
                ctx.stroke();
            }
            for (let i = 0; i <= gridHeight; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * tileSize);
                ctx.lineTo(gridWidth * tileSize, i * tileSize);
                ctx.stroke();
            }

            // Draw pixels from data
            if (window.pixelData) {
                for (let y = 0; y < gridHeight; y++) {
                    for (let x = 0; x < gridWidth; x++) {
                        const key = `${x},${y}`;
                        if (window.pixelData[key]) {
                            ctx.fillStyle = window.pixelData[key];
                            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
                        }
                    }
                }
            }
        }

        function updatePreview() {
            previewCtx.fillStyle = '#0a0a0a';
            previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);

            const previewTileSize = 128 / Math.max(gridWidth, gridHeight);
            if (window.pixelData) {
                for (let y = 0; y < gridHeight; y++) {
                    for (let x = 0; x < gridWidth; x++) {
                        const key = `${x},${y}`;
                        if (window.pixelData[key]) {
                            previewCtx.fillStyle = window.pixelData[key];
                            previewCtx.fillRect(x * previewTileSize, y * previewTileSize, previewTileSize, previewTileSize);
                        }
                    }
                }
            }
        }

        function saveHistory() {
            history.push(JSON.stringify(window.pixelData || {}));
            if (history.length > 20) history.shift();
        }

        function undoAction() {
            if (history.length > 1) {
                history.pop();
                window.pixelData = JSON.parse(history[history.length - 1]);
                updateEditorDisplay();
                updatePreview();
            }
        }

        function clearCanvas() {
            if (confirm('Clear entire canvas?')) {
                saveHistory();
                window.pixelData = {};
                updateEditorDisplay();
                updatePreview();
            }
        }

        // Mouse events
        editorCanvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            handleCanvasClick(e);
        });

        editorCanvas.addEventListener('mousemove', (e) => {
            if (isDrawing && selectedTool === 'pen') {
                handleCanvasClick(e);
            }
        });

        editorCanvas.addEventListener('mouseup', () => {
            isDrawing = false;
        });

        editorCanvas.addEventListener('mouseleave', () => {
            isDrawing = false;
        });

        function handleCanvasClick(e) {
            const rect = editorCanvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / tileSize);
            const y = Math.floor((e.clientY - rect.top) / tileSize);

            if (x >= 0 && x < gridWidth && y >= 0 && y < gridHeight) {
                window.pixelData = window.pixelData || {};

                if (selectedTool === 'pen') {
                    saveHistory();
                    window.pixelData[`${x},${y}`] = selectedColor;
                    updateEditorDisplay();
                    updatePreview();
                } else if (selectedTool === 'eraser') {
                    saveHistory();
                    delete window.pixelData[`${x},${y}`];
                    updateEditorDisplay();
                    updatePreview();
                } else if (selectedTool === 'bucket') {
                    saveHistory();
                    bucketFill(x, y, selectedColor);
                    updateEditorDisplay();
                    updatePreview();
                } else if (selectedTool === 'pickcolor') {
                    const color = window.pixelData[`${x},${y}`];
                    if (color) selectColor(color);
                }
            }
        }

        function bucketFill(x, y, color) {
            const key = `${x},${y}`;
            const originalColor = window.pixelData[key];
            
            if (originalColor === color) return;

            const queue = [[x, y]];
            const visited = new Set();

            while (queue.length > 0) {
                const [cx, cy] = queue.shift();
                const ckey = `${cx},${cy}`;

                if (visited.has(ckey)) continue;
                visited.add(ckey);

                if (cx < 0 || cx >= gridWidth || cy < 0 || cy >= gridHeight) continue;

                if ((window.pixelData[ckey] || undefined) === originalColor) {
                    window.pixelData[ckey] = color;
                    queue.push([cx + 1, cy]);
                    queue.push([cx - 1, cy]);
                    queue.push([cx, cy + 1]);
                    queue.push([cx, cy - 1]);
                }
            }
        }

        function exportSprite() {
            const name = document.getElementById('spriteName').value || 'custom_sprite';
            const type = document.getElementById('spriteType').value;
            
            // Create exportable sprite data
            const spriteData = {
                name: name,
                type: type,
                width: gridWidth,
                height: gridHeight,
                pixels: window.pixelData || {}
            };

            // Store in localStorage
            localStorage.setItem(`sprite_${name}`, JSON.stringify(spriteData));
            alert(`‚úì Sprite '${name}' saved!`);
        }

        function downloadImage() {
            const canvas = document.createElement('canvas');
            canvas.width = gridWidth * 16;
            canvas.height = gridHeight * 16;
            const c = canvas.getContext('2d');

            c.fillStyle = '#0a0a0a';
            c.fillRect(0, 0, canvas.width, canvas.height);

            if (window.pixelData) {
                for (let y = 0; y < gridHeight; y++) {
                    for (let x = 0; x < gridWidth; x++) {
                        const key = `${x},${y}`;
                        if (window.pixelData[key]) {
                            c.fillStyle = window.pixelData[key];
                            c.fillRect(x * 16, y * 16, 16, 16);
                        }
                    }
                }
            }

            const link = document.createElement('a');
            link.href = canvas.toDataURL();
            link.download = `${document.getElementById('spriteName').value || 'sprite'}.png`;
            link.click();
        }

        function addToGame() {
            exportSprite();
            alert('Sprite added to game! Return to the game to use it.');
        }

        function goBack() {
            window.location.href = 'index.html';
        }

        // Initialize on load
        window.pixelData = {};
        init();
    </script>
</body>
</html>
